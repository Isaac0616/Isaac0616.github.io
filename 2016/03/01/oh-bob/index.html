<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Internetwache CTF 2016: Oh Bob! (crypto 60) | Isaac's Blog</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/very-simple.css"><link rel="stylesheet" type="text/css" href="/css/solarized-dark.css"><link rel="stylesheet" type="text/css" href="/css/my.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><!-- include the sidebar--><!-- include ./includes/sidebar.jade--><!-- Blog title and subtitle--><header><div class="container header"><a id="logo" href="/." class="title">Isaac's Blog</a><span class="subtitle">The force is with those who read the source.</span><label id="toggle-menu" for="menu" onclick><i class="fa fa-bars"></i></label></div></header><!-- use checkbox hack for toggle nav-bar on small screens--><input id="menu" type="checkbox"><!-- Navigation Links--><nav id="nav"><div class="container"><a href="/" class="sidebar-nav-item active">Home</a><a href="/archives" class="sidebar-nav-item">Archives</a><a href="/about" class="sidebar-nav-item">About</a></div></nav><div id="header-margin-bar"></div><!-- gallery that comes before the header--><div class="wrapper"><div class="container post-header"><h1>Internetwache CTF 2016: Oh Bob! (crypto 60)</h1></div></div><div class="wrapper"><div class="container meta"><div class="post-time">2016-03-01</div><div class="post-categories"><a class="post-category-link" href="/categories/writeup/">writeup</a></div><div class="post-tags"><a class="post-tag-link" href="/tags/Internetwache-CTF/">Internetwache CTF</a>/<a class="post-tag-link" href="/tags/RSA/">RSA</a>/<a class="post-tag-link" href="/tags/crypto/">crypto</a></div></div></div><article><div class="container post"><h2 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h2><blockquote>
<p>Alice wants to send Bob a confidential message. They both remember the crypto lecture about RSA. So Bob uses openssl to create key pairs. Finally, Alice encrypts the message with Bob’s public keys and sends it to Bob. Clever Eve was able to intercept it. Can you help Eve to decrypt the message?<br><strong>Attachment:</strong> <a href="/2016/03/01/oh-bob/crypto60.zip" title="crypto60.zip">crypto60.zip</a></p>
</blockquote>
<h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>The RSA keys are too short. They are only 228 bits that can be easily fatorized by <a href="https://sourceforge.net/projects/yafu/" target="_blank" rel="external">yafu</a>. After fatorization, we can decrypt the messages use the RSA algorithm.</p>
<figure class="highlight python"><figcaption><span>publickey.py</span><a href="/2016/03/01/oh-bob/publickey.py">download</a></figcaption><table><tr><td class="gutter"><pre>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br></pre></td><td class="code"><pre><span class="hljs-keyword">import</span> rsa<br><br><span class="hljs-keyword">with</span> open(<span class="hljs-string">'bob.pub'</span>, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> f:<br>    pub1 = f.read()<br><br><span class="hljs-keyword">with</span> open(<span class="hljs-string">'bob2.pub'</span>, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> f:<br>    pub2 = f.read()<br><br><span class="hljs-keyword">with</span> open(<span class="hljs-string">'bob3.pub'</span>, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> f:<br>    pub3 = f.read()<br><br><span class="hljs-keyword">print</span> rsa.PublicKey.load_pkcs1_openssl_pem(pub1)<br><span class="hljs-keyword">print</span> rsa.PublicKey.load_pkcs1_openssl_pem(pub2)<br><span class="hljs-keyword">print</span> rsa.PublicKey.load_pkcs1_openssl_pem(pub3)<br></pre></td></tr></table></figure>
<figure class="highlight python"><figcaption><span>decrypt.py</span><a href="/2016/03/01/oh-bob/decrypt.py">download</a></figcaption><table><tr><td class="gutter"><pre>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br></pre></td><td class="code"><pre><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64decode<br><span class="hljs-keyword">import</span> rsa<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">extended_gcd</span><span class="hljs-params">(aa, bb)</span>:</span><br>    lastremainder, remainder = abs(aa), abs(bb)<br>    x, lastx, y, lasty = <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> remainder:<br>        lastremainder, (quotient, remainder) = remainder, divmod(lastremainder, remainder)<br>        x, lastx = lastx - quotient*x, x<br>        y, lasty = lasty - quotient*y, y<br>    <span class="hljs-keyword">return</span> lastremainder, lastx * (<span class="hljs-number">-1</span> <span class="hljs-keyword">if</span> aa &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-number">1</span>), lasty * (<span class="hljs-number">-1</span> <span class="hljs-keyword">if</span> bb &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-number">1</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">modinv</span><span class="hljs-params">(a, m)</span>:</span><br>    g, x, y = extended_gcd(a, m)<br>    <span class="hljs-keyword">if</span> g != <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">raise</span> ValueError<br>    <span class="hljs-keyword">return</span> x % m<br><br>n = <span class="hljs-number">359567260516027240236814314071842368703501656647819140843316303878351</span><br>p = <span class="hljs-number">17963604736595708916714953362445519</span><br>q = <span class="hljs-number">20016431322579245244930631426505729</span><br>e = <span class="hljs-number">65537</span><br>d = modinv(e, (p<span class="hljs-number">-1</span>)*(q<span class="hljs-number">-1</span>))<br>pk = rsa.PrivateKey(n, e, d, p, q)<br><span class="hljs-keyword">print</span> rsa.decrypt(b64decode(<span class="hljs-string">'DK9dt2MTybMqRz/N2RUMq2qauvqFIOnQ89mLjXY='</span>), pk)<br><br>n = <span class="hljs-number">273308045849724059815624389388987562744527435578575831038939266472921</span><br>p = <span class="hljs-number">16549930833331357120312254608496323</span><br>q = <span class="hljs-number">16514150337068782027309734859141427</span><br>e = <span class="hljs-number">65537</span><br>d = modinv(e, (p<span class="hljs-number">-1</span>)*(q<span class="hljs-number">-1</span>))<br>pk = rsa.PrivateKey(n, e, d, p, q)<br><span class="hljs-keyword">print</span> rsa.decrypt(b64decode(<span class="hljs-string">'CiLSeTUCCKkyNf8NVnifGKKS2FJ7VnWKnEdygXY='</span>), pk)<br><br>n = <span class="hljs-number">333146335555060589623326457744716213139646991731493272747695074955549</span><br>p = <span class="hljs-number">19193025210159847056853811703017693</span><br>q = <span class="hljs-number">17357677172158834256725194757225793</span><br>e = <span class="hljs-number">65537</span><br>d = modinv(e, (p<span class="hljs-number">-1</span>)*(q<span class="hljs-number">-1</span>))<br>pk = rsa.PrivateKey(n, e, d, p, q)<br><span class="hljs-keyword">print</span> rsa.decrypt(b64decode(<span class="hljs-string">'AK/WPYsK5ECFsupuW98bCFKYUApgrQ6LTcm3KxY='</span>), pk)<br></pre></td></tr></table></figure>
<blockquote>
<p>Flag: <code>IW{WEAK_RSA_K3YS_4R3_SO_BAD!}</code></p>
</blockquote>
</div><!-- comment system--><div class="container"><hr><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = 'poning';
var disqus_identifier = '2016/03/01/oh-bob/';
var disqus_title = 'Internetwache CTF 2016: Oh Bob! (crypto 60)';
var disqus_url = 'http://poning.me/2016/03/01/oh-bob/';
(function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a></div></article><footer id="footer"><div class="container"><div class="bar"><div class="social"><a href="mailto:i@poning.me" target="_blank"><i class="fa fa-envelope-o"></i></a><a href="https://github.com/Isaac0616" target="_blank"><i class="fa fa-github"></i></a><a href="/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></div><div class="footer">© 2016 <a href="/" rel="nofollow">Isaac Tseng</a>. Powered by <a rel="nofollow" target="_blank" href="https://hexo.io">Hexo</a>. Theme <a target="_blank" href="https://github.com/lotabout/very-simple">very-simple</a>.</div></div></div></footer><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script></body><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
e=o.createElement(i);r=o.getElementsByTagName(i)[0];
e.src='//www.google-analytics.com/analytics.js';
r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
ga('create','UA-86477289-1');ga('send','pageview');</script></html>